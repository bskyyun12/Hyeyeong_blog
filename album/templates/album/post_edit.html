{% extends 'base.html' %}

{% block extrahead %}
    <!-- need to add to use bootstrap_datepicker_plus -->
    {{ form.media }}
{% endblock %}

{% block content %}
<h1>Edit post</h1>

<form method="post" enctype="multipart/form-data" autocomplete="off">
    {% csrf_token %}

    Current image(s):
    <ul>
        {% for image in images %}
        <li>
            {{ image.image }}
            <a class="text-danger" href="{% url 'album:image_remove' operation='post_edit' pk=image.pk %}">Delete</a>
        </li>
        {% endfor %}
    </ul>
    <label>Pictures</label>
    <div class="custom-file">
        <input id="fileupload" type="file" name="image" multiple onchange="javascript:updateList()" class="custom-file-input" accept="image/*">
        <label class="custom-file-label" for="inputGroupFile02">Add more pictures</label>
    </div>
    <div id="fileList">

    </div>

    <label>{{ form.title.label }}</label>
    <input placeholder="{{ form.title.label }}" value="{{ form.title.value }}" name="title" class="form-control" required maxlength="30">

    <label>{{ form.description.label }}</label>
    <input placeholder="{{ form.description.label }}" value="{{ form.description.value }}" name="description" class="form-control" required maxlength="300">

    <label>{{ form.date.label }}{{ form.date.errors }}</label>
    {{form.date}}

    <!-- emoticons -->
    <label>{{ form.emoticon.label }}{{ form.emoticon.errors }}</label>

    <div class="row">
        {% for value, text in form.emoticon.field.choices %}
        <div class="col-3 col-sm-2 col-lg-1">
            <input id="id_emoticons_{{ forloop.counter0 }}" name="{{ form.emoticon.name }}" type="checkbox" value="{{ value }}"
                {% for emot in form.emoticon.value %}
                    {% ifequal emot value %}
                        checked="checked"
                    {% endifequal %}
                {% endfor %}>
            <label for="id_emoticons_{{ forloop.counter0 }}"><img class="img-responsive" src="/media/emoticons/{{value}}.png" style="width: 100%; display: block;"> {{text}}</label>
        </div>
        {% endfor %}
    </div>

    <hr>
    <button type="submit" name="button" class="btn btn-primary">Submit</button>
</form>
{% endblock %}

{% block script %}
<!-- Displays selected files -->
<script type="text/javascript">
    updateList = function() {
        var input = document.getElementById('fileupload');
        var output = document.getElementById('fileList');

        htmlStr = 'Selected files:<ul>';
        for (var i = 0; i < input.files.length; ++i) {
            htmlStr += '<li>' + input.files.item(i).name + '</li>';
        }
        htmlStr += '</ul>';
        output.innerHTML = htmlStr
    }
</script>

<script type="text/javascript">
    $(function() {
        $('#datepicker').datepicker({
            format: 'yyyy-mm-dd',
            autoclose: true,
            todayHighlight: true,
        });
    });
</script>

<script type="text/javascript">
    $('input[type=checkbox]').on('change', function(e) {
        if ($('input[type=checkbox]:checked').length > 3) {
            $(this).prop('checked', false);
            alert("You can't choose more than 3.");
        }
        if ($('input[type=checkbox]:checked').length < 1) {
            $(this).prop('checked', true);
            alert("You should choose at least 1 emoticon.");
        }
    });
</script>
{% endblock %}
